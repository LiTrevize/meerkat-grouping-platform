<head>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<style>
  .container_all{
    padding-right:100px;
    padding-left:100px;  
  }
  .p1{
    font-family: "Lucida Console", "Courier New", monospace;
  }
  .title{
    font-family: "Lucida Console", "Courier New", monospace;
    font-weight: bold;
  }
  .content{
    font-family: "Lucida Console", "Courier New", monospace;
    font-size: 40px;
  }
  .comment_box_format{
    width:500px;  
  }
  .comment-title {
    font-size: 16px;
    font-weight: bold;
  }
  .comment-text {
    margin: 0px 0px 5px 0px
    /* font-size:16px; */
  }
  .sub-comment {
    margin-left:55px;
    margin-top:10px;
  }
  .comment-meta {
  font-size: 12px;
  color: grey;
  font-weight: bolder;
  margin-right: 5px;
  }
  </style>
</head>

<%= render partial: 'posts/header', locals: {title: 'Post', posts: '', group: @group} %>

<div class="container_all">

<p class="p1"><%= flash[:msg] %></p>

<h5> Post: </h5>

<div>
  Title: 
   <%= @post.title %>
</div>

<div>
  Content:
  <%= @post.content %>
</div>

<div>
   Number of people needed for this group: <%= @post.low_number %>-<%= @post.low_number %>
</div>

<br/>
<h5> Application: </h5>

<% if @post.user_id === @current_user.id%>
<div>
  Pending Applications:
</div>
<div>
  <% for i in 0..@applied_user_name.length()-1 %>
  <div>
    Application from: <%= @applied_user_name[i] %>
    <div class="btn btn-primary">
        <%= link_to "Approve",@approve_url[i], :method => :post, :class => "link"%>
        <%= link_to "Reject",@reject_url[i], :method => :post, :class => "link"%>   
    </div>
  </div>
  <% end %> 
</div>
<div>
  Approved Applications:
</div>
<div>
  <% for i in 0..@approved_user_name.length()-1 %>
  <div>
    <%= @approved_user_name[i] %>
  </div>
  <% end %>  
</div>
  
<% else %>
<div>
  <div>
    status:<%=  @current_group_user_status %>
  </div>
    
  <% flash.each do |type, msg| %>
    <div class="p1">
      <%= msg %>
    </div>
  <% end %>
  
  <% if @current_group_user_status == "You haven't applied for this Group" %>
    <div class="btn btn-primary">
        <%= link_to "Apply", apply_path(@post), :method => :post, :class => "link"%>   
    </div>
  <% elsif @current_group_user_status == "rejected" %>
    <div>
      Sorry, your application is rejected by the host. Feel free to check out other groups
    </div>
  <% elsif @current_group_user_status == "approved" %>
      <div>
        Your application is approved and the host has sent you an invitation!
        Once you accepted the invitation, you will have access to the group chat.
        <p>      
        <%= link_to "Join the group!",accept_path(@post), :method => :post, :class => "link"%>
        <%= link_to "Hmmm..I don't want to join anymore",refuse_path(@post), :method => :post, :class => "link"%>
        </p>
      </div>
  <% elsif @current_group_user_status == "refused" %>
    <div>
      You have applied for this group before and you were invited to join, but you refused the invitation.
  </div>
  
  <% elsif @current_group_user_status == "accepted" %>
  <div>
      Woho! You are a group member!
  </div>
  
  <% end %>
</div>
 <% end %>  
 
 
<br/>
<h5>Comments: </h5>

<%= form_tag create_comment_path, :class => 'form' do %>
  <%= label :to_comment, :to, 'reply to all', :class => 'col-form-label' %>
  <%= text_field :to_comment, :content, :class => 'form-control comment_box_format', :id => 'comment_box' %>
  <%= label :to_comment, :is_public, 'is public', :class => 'col-form-label' %>
  <%= check_box_tag "is_public", true %>
  <%= text_field :to_comment, :id, :value => params[:to_comment_id], :hidden => true, :class => 'form-control' %>
  <%= text_field :to_comment, :leader_id, :value => params[:to_comment_leader_id], :hidden => true, :class => 'form-control' %>
  <%= submit_tag 'reply', :class => 'btn btn-outline-primary btn-sm' %>
<% end %>

<hr>

<div class="container">
  <% @comments.each do |comment| %>
    <% if comment.is_public or comment.from_user_id == @current_user.id or @post.user_id == @current_user.id or comment.to_user_id == @current_user.id %>
    <div class="row">
      <div class="col-auto">
        <span class="media-heading comment-title badge badge-info"><%= comment.from_nickname %></span>
      </div>
      <div class="col">
        <div class="comment-text"><%= comment.content %></div>
        <div class="comment-meta">
          <span style="margin-right: 10px"><%= timef comment.created_at %></span>
          <%= link_to "reply", post_path(@post, to_comment_id: comment.id, to_user_id: comment.from_user_id, to_nickname: comment.from_nickname, to_comment_leader_id: comment.id), method: :get %>
        </div>
      </div>

      <% if params[:to_comment_id] == comment.id.to_s %>
        <%= form_tag create_comment_path, :class => 'form' do %>
          <%= label :to_comment, :to, "reply to #{comment.from_nickname}", :class => 'col-form-label' %>
          <%= text_field :to_comment, :content, :class => 'form-control comment_box_format', :id => 'comment_box' %>
          <%= label :to_comment, :is_public, 'is public', :class => 'col-form-label' %>
          <%= check_box_tag "is_public", true %>
          <%= text_field :to_comment, :id, :value => params[:to_comment_id], :hidden => true, :class => 'form-control' %>
          <%= text_field :to_comment, :leader_id, :value => params[:to_comment_leader_id], :hidden => true, :class => 'form-control' %>
          <%= submit_tag 'reply', :class => 'btn btn-outline-primary btn-sm' %>
        <% end %>
      <% end %>

      <% comment.subs.each do |sub| %>
      <% if sub.is_public or sub.from_user_id == @current_user.id or @post.user_id == @current_user.id or sub.to_user_id == @current_user.id %>
      <div class="row sub-comment">
        <div class="col-auto">
          <span class="media-heading comment-title badge badge-info"><%= sub.from_nickname %></span>
          <% if sub.to_nickname %>
          <div class="comment-meta" style="margin-top: 5px"><%= "(to #{sub.to_nickname})" %></div>
          <% end %>
        </div>
        <div class="col">
          <div class="comment-text"><%= sub.content %></div>
          <div class="comment-meta">
            <span style="margin-right: 10px"><%= timef sub.created_at %></span>
            <%= link_to "reply", post_path(@post, to_comment_id: sub.id, to_user_id: sub.from_user_id, to_nickname: sub.from_nickname, to_comment_leader_id: comment.id), method: :get %>
          </div>
        </div>

        <% if params[:to_comment_id] == sub.id.to_s %>
        <%= form_tag create_comment_path, :class => 'form' do %>
          <%= label :to_comment, :to, "reply to #{sub.from_nickname}", :class => 'col-form-label' %>
          <%= text_field :to_comment, :content, :class => 'form-control comment_box_format', :id => 'comment_box' %>
          <%= label :to_comment, :is_public, 'is public', :class => 'col-form-label' %>
          <%= check_box_tag "is_public", true %>
          <%= text_field :to_comment, :id, :value => params[:to_comment_id], :hidden => true, :class => 'form-control' %>
          <%= text_field :to_comment, :leader_id, :value => params[:to_comment_leader_id], :hidden => true, :class => 'form-control' %>
          <%= submit_tag 'reply', :class => 'btn btn-outline-primary btn-sm' %>
        <% end %>
      <% end %>
      </div>
      <% end %>
      <% end %>

      <hr style="margin-top: 16px">
    </div>
    <% end %>
  <% end %>
</div>


  

<br/>
<h5>Group Members: </h5>
<table class="table col-md-12" id="comment">
  <thead>
    <tr>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <% @all_members.each do |member| %>
    <tr>
        <td>
          <%= member.name %><br/>
      </td>
    </tr>
    <% end %>
  </tbody>
</table>

</div>
  
  